{% extends 'base.html' %}

{% block title %}Task List{% endblock %}

{% block content %}
<div class="task-header mb-4">
    <h2 class="username">{{ request.user.username }}</h2>
    <h6 class="task-count">You have {{ count }} task{{ count|pluralize }} to complete</h6>
    <hr>
</div>

<div class="task-controls d-flex justify-content-between align-items-center mb-4 flex-wrap">
    <a href="{% url 'todo:task-create' %}" class="btn btn-primary btn-sm add-task-btn">Add Task</a>
    <form method="get" class="search-form d-flex" id="taskSearchForm">
        <input type="text" name="search-area" placeholder="Search" value="{{ search_input }}"
            class="form-control form-control-sm me-2" id="searchInput">
        <button type="submit" class="btn btn-outline-secondary btn-sm">Search</button>
    </form>
</div>

{% if tasks %}
<div class="task-list">
    {% for task in tasks %}
    <div class="todo-card d-flex justify-content-between align-items-center mb-3 p-2">
        <div class="task-info">
            <a href="{% url 'todo:task-detail' task.id %}"
                class="task-title {% if task.complete %}completed{% endif %}">
                {{ task.title }}
            </a>
        </div>
        <div class="task-actions d-flex align-items-center">
            <form method="POST" action="{% url 'todo:task-toggle' task.id %}" class="me-2">
                {% csrf_token %}
                <input type="checkbox" name="complete" class="form-check-input" onchange="this.form.submit()" {% if task.complete %}checked{% endif %}>
            </form>
            <a href="{% url 'todo:task-update' task.id %}" class="btn btn-sm btn-outline-info me-2">Edit</a>
            <a href="{% url 'todo:task-delete' task.id %}" class="btn btn-sm btn-outline-danger">Delete</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p class="no-tasks">No tasks found</p>
{% endif %}

{% endblock %}